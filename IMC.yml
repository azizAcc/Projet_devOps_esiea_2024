pipeline {
    agent any
    parameters {
        string(name: 'NAME', description: 'Please tell me your name')
        string(name: 'AGE', description: 'What is your age?')
        string(name: 'WEIGHT', description: 'Please tell me your weight (in KG)')
        string(name: 'HEIGHT', description: 'Please tell me your height (in cm)')
        string(name: 'LOSE', description: 'How many weight you want to lose? (in KG)')
        booleanParam(name: 'SKIP_TEST', description: 'Want to skip running Test cases?')
        choice(name: 'SEX', choices: ['MALE', 'FEMALE'], description: 'Choose your sex')
    }
    stages {
        stage('BUILD') {
            steps {
                echo 'Building app...'
                sleep 1
                echo 'Build OK!'
                // ... (rest of the build steps)
                echo 'Build COMPLETE!'
            }
        }
        stage('TEST') {
            steps {
                script {
                    if (params.SKIP_TEST) {
                        echo 'Skipping tests...'
                    } else {
                        echo 'Testing app...'
                        // ... (rest of the test steps)
                        echo 'Test COMPLETE!'
                    }
                }
            }
        }
        stage('DEPLOY') {
            steps {
                script {
                    def pythonScript = 'calculAndDetermineHealth.py'
        
                    // Exécution du script Python pour calculer l'IMC et déterminer l'état de santé
                    def result = bat(script: "python ${pythonScript} ${params.HEIGHT} ${params.WEIGHT}", returnStatus: true)
        
                    if (result == 0) {
                        // Traitement réussi
                        echo 'Deploy COMPLETE!'
                    } else {
                        // Erreur pendant l'exécution
                        currentBuild.result = 'FAILURE'
                    }
                }
            }
        }
    }
}
