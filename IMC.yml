pipeline {
    agent any
    parameters {
        string(name: 'NAME', description: 'Please tell me your name')
        string(name: 'AGE', description: 'What is your age?')
        string(name: 'WEIGHT', description: 'Please tell me your weight (in KG)')
        string(name: 'HEIGHT', description: 'Please tell me your height (in cm)')
        string(name: 'LOSE', description: 'How many weight you want to lose? (in KG)')
        booleanParam(name: 'SKIP_TEST', description: 'Want to skip running Test cases?')
        choice(name: 'SEX', choices: ['MALE', 'FEMALE'], description: 'Choose your sex')
    }
    stages {
        stage('BUILD') {
            steps {
                echo 'Building app...'
                sleep 1
                echo 'Build OK!'
                // ... (rest of the build steps)
                echo 'Build COMPLETE!'
            }
        }
        stage('TEST') {
            steps {
                script {
                    if (params.SKIP_TEST) {
                        echo 'Skipping tests...'
                    } else {
                        echo 'Testing app...'
                        // ... (rest of the test steps)
                        echo 'Test COMPLETE!'
                    }
                }
            }
        }
        stage('DEPLOY') {
            steps {
                script {
                    def pythonScript = 'calculImc.py'
                    def healthStateScript = 'heathStateImc.py'
        
                    // Exécution du script Python pour calculer l'IMC
                    def BMIResult = bat(script: "python ${pythonScript} ${params.HEIGHT} ${params.WEIGHT}", returnStatus: false).trim()
                    def BMI = BMIResult ? BMIResult : "N/A"
        
                    // Stocker la valeur de l'IMC dans une variable Groovy
                    def imcValue = BMI.toBigDecimal() // Conversion en BigDecimal pour assurer la précision
        
                    // Exécution du script Python pour déterminer l'état de santé
                    def healthStateResult = bat(script: "python ${healthStateScript} ${imcValue}", returnStatus: false).trim()
                    def healthState = healthStateResult ? healthStateResult : "N/A"
        
                    def stringSex = params.SEX == "MALE" ? "Mister" : "Miss"
        
                    echo "Welcome ${stringSex} ${params.NAME},\nCurrently, you are ${params.AGE} years old,\nweigh ${params.WEIGHT} kg,\nare ${params.HEIGHT} cm tall\nand, you want to lose ${params.LOSE} kg.\n\nYour actual BMI is: ${BMI}\n${healthState}\n\nGood luck and keep hope!"
        
                    sleep 12
                    echo 'Deploy COMPLETE!'
                }
            }
        }
    }
}
